<h1 class="page-title">Real Tennis Clubs — Towels</h1>

<section id="playing-message" class="playing-message" aria-live="polite" role="status">
  <span class="prefix">I AM PLAYING AT</span>

  <!-- Dropdown embedded directly in the sentence -->
  <div class="club-dropdown-wrapper">
    <select id="club-select" class="club-select">
  <option value="">SELECT CLUB</option>
  <% @clubs.each do |club| %>
    <option value="<%= club.id %>" <%= 'selected' if club == @random_club %>><%= club.name %></option>
  <% end %>
</select>
    <div class="dropdown-arrow">▼</div>
  </div>

  <span id="towel-statement" class="towel-statement"></span>
  <div id="notes" class="notes" aria-hidden="true"></div>
</section>

<script>
document.addEventListener('DOMContentLoaded', function() {
  const select = document.getElementById('club-select');
  const towelStatementEl = document.getElementById('towel-statement');
  const notesEl = document.getElementById('notes');

  function clearMessage() {
    towelStatementEl.textContent = '';
    notesEl.textContent = '';
  }

  function loadClub(id) {
    if (!id) { clearMessage(); return; }

    fetch(`/clubs/${id}/status`)
      .then(r => {
        if (!r.ok) throw new Error('Network error');
        return r.json();
      })
      .then(data => {
        const willOrNot = data.supplies_towels
          ? "SO THERE WILL BE TOWELS."
          : "SO THERE WON'T BE TOWELS.";
        towelStatementEl.textContent = willOrNot;
        notesEl.textContent = data.notes ? data.notes : '';
      })
      .catch(err => {
        console.error(err);
        clearMessage();
        towelStatementEl.textContent = 'ERROR FETCHING STATUS.';
      });
  }

  select.addEventListener('change', function() {
    loadClub(select.value);
  });

  // Automatically load the randomly selected club on page load
  if (select.value) {
    loadClub(select.value);
  } else {
    clearMessage();
  }
});
</script>